#!/bin/bash
echo "*** -------------Starting Terrafrom------------- ***"
echo "** Formatting Terraform **" && terraform fmt && echo "** Format Complete **" && echo "** Validating Terraform **" && terraform validate && echo "** Validate Complete **" && echo "** Planning Terraform **" && terraform plan && echo "** Plan Complete **" && echo "** Applying Terraform Automatically **" && terraform apply --auto-approve && read -p "Enter the registry name: " registry_name && echo "** Registry Login **" && az acr login -n $registry_name && read -p "Enter the image name for tagging: " image_name && docker tag $image_name $registry_name/samples/$image_name && echo "Image Tagged" && docker push $registry_name/samples/$image_name && echo "** Pushed Successfully **" && echo "Restarting The Container Instance" && terraform apply --auto-approve --var image="$registry_name/samples/$image_name" && echo "--------------Done!--------------"
terraform destroy --auto-approve | at now +2 minutes && echo "-----------Destroy Complete-----------!"
